import{_ as s,c as a,o as i,a4 as t}from"./chunks/framework.Bl20_RFa.js";const u=JSON.parse('{"title":"Stack Configuration","description":"Learn how to configure the metadata and orchestration behavior of stacks in Terramate.","frontmatter":{"title":"Stack Configuration","description":"Learn how to configure the metadata and orchestration behavior of stacks in Terramate."},"headers":[],"relativePath":"cli/stacks/configuration.md","filePath":"cli/stacks/configuration.md"}'),e={name:"cli/stacks/configuration.md"},n=t(`<h1 id="configure-stacks" tabindex="-1">Configure stacks <a class="header-anchor" href="#configure-stacks" aria-label="Permalink to &quot;Configure stacks&quot;">​</a></h1><p>Stacks can be configured in the <code>stack {}</code> block (by default in <code>stack.tm.hcl</code>). The options available cover:</p><ul><li>Configuring Metadata (<code>name</code>, <code>description</code>, <code>id</code>, <code>tags</code>) for targeting</li><li>Changing the order of execution (<code>before</code>, <code>after</code>)</li><li>Triggering options (<code>watch</code>, <code>wants</code>, <code>wanted_by</code>)</li></ul><h2 id="configure-metadata" tabindex="-1">Configure metadata <a class="header-anchor" href="#configure-metadata" aria-label="Permalink to &quot;Configure metadata&quot;">​</a></h2><h3 id="stack-id-string-optional" tabindex="-1">stack.id (string)(optional) <a class="header-anchor" href="#stack-id-string-optional" aria-label="Permalink to &quot;stack.id (string)(optional)&quot;">​</a></h3><p>The stack ID <strong>must</strong> be a string composed of alphanumeric chars + <code>-</code> + <code>_</code>. The ID can&#39;t be bigger than 64 bytes, <strong>is case insensitive</strong> and <strong>must</strong> be unique over the whole project.</p><p>There is no default value determined for the stack ID, but when users use the <a href="./../cmdline/create">create</a> command to create new stacks or the <a href="./../cmdline/experimental/experimental-clone">clone</a> command to clone stacks, the ID will default to a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier#:~:text=Version%204%20(random)%5Bedit%5D" target="_blank" rel="noreferrer">random UUID</a>.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;some_id_that_must_be_unique&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="stack-name-string-optional" tabindex="-1">stack.name (string)(optional) <a class="header-anchor" href="#stack-name-string-optional" aria-label="Permalink to &quot;stack.name (string)(optional)&quot;">​</a></h3><p>The stack name can be any string and defaults to the stack directory base name.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;My Awesome Stack Name&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="stack-description-string-optional" tabindex="-1">stack.description (string)(optional) <a class="header-anchor" href="#stack-description-string-optional" aria-label="Permalink to &quot;stack.description (string)(optional)&quot;">​</a></h3><p>The stack description can be any string and defaults to an empty string.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  description</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;My Awesome Stack Description&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="stack-tags-set-string-optional" tabindex="-1">stack.tags (set(string))(optional) <a class="header-anchor" href="#stack-tags-set-string-optional" aria-label="Permalink to &quot;stack.tags (set(string))(optional)&quot;">​</a></h3><p>The tags list must be a unique set of strings where each tag must adhere to the following rules:</p><ul><li>It must start with a lowercase ASCII alphabetic character (<code>[a-z]</code>).</li><li>It must end with a lowercase ASCII alphanumeric character (<code>[0-9a-z]</code>).</li><li>It must have only lowercase ASCII alphanumeric, <code>_</code> and \`\` characters (<code>[0-9a-z_-]</code>).</li></ul><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  tags</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;aws&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;vpc&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;bastion&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="configuring-the-order-of-execution" tabindex="-1">Configuring the order of execution <a class="header-anchor" href="#configuring-the-order-of-execution" aria-label="Permalink to &quot;Configuring the order of execution&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>It&#39;s a best practice to use tags instead of paths for defining the order of execution of stacks with <code>before</code> and <code>after</code>.</p></div><h3 id="stack-after-set-string-optional" tabindex="-1">stack.after (set(string))(optional) <a class="header-anchor" href="#stack-after-set-string-optional" aria-label="Permalink to &quot;stack.after (set(string))(optional)&quot;">​</a></h3><p><code>after</code> defines a list of stacks that this stack must run after. It accepts project absolute paths (like <code>/other/stack</code>), paths relative to the directory of this stack (e.g.: <code>../other/stack</code>) or a <a href="./../orchestration/#filter-by-tags">Tag Filter</a>.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  after</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tag:prod:networking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/prod/apps/auth&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The stack above will run after all stacks tagged with <code>prod</code> <strong>and</strong> <code>networking</code> and after <code>/prod/apps/auth</code> stack.</p><p>See the <a href="./../orchestration/#order-of-execution">orchestration docs</a> for details.</p><h3 id="stack-before-set-string-optional" tabindex="-1">stack.before (set(string))(optional) <a class="header-anchor" href="#stack-before-set-string-optional" aria-label="Permalink to &quot;stack.before (set(string))(optional)&quot;">​</a></h3><p>Defines the list of stacks that this stack must run <code>before</code>, following the same rules as <code>after</code>.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  before</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;tag:prod:networking&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/prod/apps/auth&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="configure-triggering-options" tabindex="-1">Configure triggering options <a class="header-anchor" href="#configure-triggering-options" aria-label="Permalink to &quot;Configure triggering options&quot;">​</a></h2><h3 id="stack-watch-list-optional" tabindex="-1">stack.watch (list)(optional) <a class="header-anchor" href="#stack-watch-list-optional" aria-label="Permalink to &quot;stack.watch (list)(optional)&quot;">​</a></h3><p>The list of files that must be watched for changes in the <a href="./../change-detection/">change detection</a>.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  watch</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/policies/mypolicy.json&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The configuration above will mark the stack as changed whenever the file <code>/policies/mypolicy.json</code> changes.</p><h3 id="stack-wants-set-string-optional" tabindex="-1">stack.wants (set(string))(optional) <a class="header-anchor" href="#stack-wants-set-string-optional" aria-label="Permalink to &quot;stack.wants (set(string))(optional)&quot;">​</a></h3><p>This attribute defines a list of stacks that will be run whenever this stack is run. Example:</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  wants</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/other/stack&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This can be useful to force a dependency relationship between stacks - for example, if a dependent stack is outside of the scope (the nested directory hierarchy). E.g., if we had the following hierarchy:</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/stacks</span></span>
<span class="line"><span>  /stack-a</span></span>
<span class="line"><span>    /stack-a-1</span></span>
<span class="line"><span>    /stack-a-2</span></span>
<span class="line"><span>  /stack-b</span></span></code></pre></div><p>Running <code>terramate -C stacks/stack-a</code> would run <code>stack-a</code>, <code>stack-a-1</code> and <code>stack-a-2</code>.</p><p>But if <code>stack-a-2</code> always requires stack-b to run, we could put <code>wants = [&quot;/stacks/stack-b&quot;]</code> into the <code>stack-a-2</code> configuration and it would always be added to the execution list whenever <code>stack-a-2</code> was targeted.</p><div class="info custom-block"><p class="custom-block-title">INFO</p><p>It&#39;s <em>very important to note</em> that adding a stack to <code>wants</code> <em>does not alter the run order</em>. If you want a dependent stack to run before or after another you must also use the <code>before</code> and <code>after</code> attributes.</p></div><h3 id="stack-wanted-by-set-string-optional" tabindex="-1">stack.wanted_by (set(string))(optional) <a class="header-anchor" href="#stack-wanted-by-set-string-optional" aria-label="Permalink to &quot;stack.wanted_by (set(string))(optional)&quot;">​</a></h3><p>This attribute is similar to <code>stack.wants</code> but works reversely. That is, using the same hierarchy as above, we could achieve the same result (including <code>stack-b</code> whenever we trigger <code>stack-a-2</code>) by putting <code>wanted_by = [&quot;/stacks/stack-a-2&quot;]</code> in the stack-b configuration.</p><div class="language-txt vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>/stacks</span></span>
<span class="line"><span>  /stack-a</span></span>
<span class="line"><span>    /stack-a-1</span></span>
<span class="line"><span>    /stack-a-2</span></span>
<span class="line"><span>  /stack-b</span></span></code></pre></div><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># stack-b/stack.tm.hcl</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  wanted_by</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/stacks/stack-a-2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,45),l=[n];function o(p,c,h,r,k,d){return i(),a("div",null,l)}const E=s(e,[["render",o]]);export{u as __pageData,E as default};
