import{_ as e,c as s,o as a,a4 as i}from"./chunks/framework.Bl20_RFa.js";const E=JSON.parse('{"title":"Generate Files","description":"Learn how to use Terramate to generate files such as JSON or YAML.","frontmatter":{"title":"Generate Files","description":"Learn how to use Terramate to generate files such as JSON or YAML."},"headers":[],"relativePath":"cli/code-generation/generate-file.md","filePath":"cli/code-generation/generate-file.md"}'),t={name:"cli/code-generation/generate-file.md"},n=i(`<h1 id="file-code-generation" tabindex="-1">File Code Generation <a class="header-anchor" href="#file-code-generation" aria-label="Permalink to &quot;File Code Generation&quot;">​</a></h1><p>Terramate supports the generation of arbitrary files such as JSON or YAML referencing data such as <a href="./variables/">Variables</a> and <a href="./variables/metadata">Metadata</a>.</p><h2 id="the-generate-file-block" tabindex="-1">The <code>generate_file</code> block <a class="header-anchor" href="#the-generate-file-block" aria-label="Permalink to &quot;The \`generate_file\` block&quot;">​</a></h2><p>File code generation is done using <code>generate_file</code> blocks in Terramate configuration files. References to Terramate globals and metadata are evaluated.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generate_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &quot;hello_world.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tm_jsonencode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">world</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The label of the <code>generate_file</code> block names the file that will be generated. Terramate Variables (<code>let</code>, <code>global</code>, and <code>terramate</code> namespaces) and all <a href="./functions/">Terramate Functions</a> are supported when defining labels. For more details about how code generation uses labels check the <a href="./#labels">Labels Overview</a> docs.</p><h3 id="argument-reference-of-the-generate-file-block" tabindex="-1">Argument reference of the <code>generate_file</code> block <a class="header-anchor" href="#argument-reference-of-the-generate-file-block" aria-label="Permalink to &quot;Argument reference of the \`generate_file\` block&quot;">​</a></h3><ul><li><p><code>context</code> <em>(optional string)</em> The <code>context</code> attributes that override the <a href="./#generation-context">generation</a> context](index.md#generation-context)</p></li><li><p><code>content</code> <em>(required string)</em> The <code>content</code> argument defines the string that will be generated as the content of the file. The value of the <strong><code>content</code></strong> has access to different Terramate features depending on the <code>context</code> defined.</p><p>For <code>context=root</code> it has access to:</p><ul><li>Terramate Project Metadata references <code>terramate.root.*</code> and <code>terramate.stacks.*</code></li><li><a href="./functions/">Terramate function</a> calls <code>tm_*(...)</code></li><li>Expressions using string interpolation <code>&quot;\${}&quot;</code></li></ul><p>and for <code>context=stack</code> (the default), it has access to everything that <code>root</code> has plus the features below:</p><ul><li>Terramate Global references <code>global.*</code></li><li>Terramate Stack Metadata references <code>terramate.stack.*</code></li></ul><p>The final evaluated value of the <strong><code>content</code></strong> attribute <strong>must</strong> be a valid string.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;-EOF</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  Hello World!</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">EOF</span></span></code></pre></div></li><li><p><code>lets</code> <em>(optional block)</em> One or more <code>lets</code> blocks can be used to define <a href="./variables/lets">temporary variables</a> that can be used in other arguments within the <code>generate_file</code> block and in the <code>content</code> block.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">lets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  temp_a_plus_b</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> global</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">a </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> global</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">b</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p><code>stack_filter</code> <em>(optional block)</em> Stack filter allow to filter stacks where the code generation should be executed. Currently, only path-based filters are available but tag-based filters are coming soon. Stack filters do neither support Terramate Functions nor Terramate Variables. For advanced filtering of stacks based on additional conditions and complex expressions please use <code>condition</code> argument. <code>stack_filter</code> blocks have precedence over <code>conditions</code> and will be executed first for performance reasons. A stack will only be selected for code generation if any <code>stack_filter</code> is <code>true</code> and the <code>condition</code> is <code>true</code> too.</p><p>Each <code>stack_filter</code> block supports one or more of the following arguments. When specifying more attributes, all need to be <code>true</code> to mark the <code>stack_filter</code> block as <code>true</code>.</p><ul><li><code>project_paths</code> <em>(optional list of strings)</em> A list of patterns matched against the absolute project path of the stack. The patterns support globbing but no regular expressions. Any matched path in the list will mark the project path filter as <code>true</code>.</li><li><code>repository_paths</code> <em>(optional list of strings)</em> A list of patterns matched against the absolute repository path of the stack. The patterns support globbing but no regular expressions. Any matched path in the list will mark the repository path filter as <code>true</code>.</li></ul><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stack_filter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  project_paths</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/path/to/specific/stack&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># match exact path</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/path/to/some/stacks/*&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># match stacks in a directory</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;/path/to/many/stacks/**&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># match all stacks within a tree</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p><code>condition</code> <em>(optional boolean)</em> The <code>condition</code> attribute supports any expression that renders to a boolean. Terramate Variables (<code>let</code>, <code>global</code>, and <code>terramate</code> namespaces) and all Terramate Functions are supported. Variables are evaluated with the stack context (see Lazy Evaluation) If the condition is <code>true</code> and any <code>stack_filter</code> (if defined) is <code>true</code> the stack is selected for generating the code. As evaluating the condition for multiple stacks can be slow, using <code>stack_filter</code> for path-based generation is recommended.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">condition</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tm_anytrue</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">([</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   tm_contains</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(terramate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">stack</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">tags, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;my-tag&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># only render if tag is set</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   tm_try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(global</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">render_stack, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">), </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># only render if \`render_stack\` is \`true\`</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">])</span></span></code></pre></div></li><li><p><code>assert</code> <em>(optional block)</em> One or more <code>assert</code> blocks can be used to prevent wrong configurations in code generation assertion can be set to guarantee all preconditions for generating code are satisfied. Each <code>assert</code> block supports the following arguments:</p><ul><li><code>assertion</code> <em>(required boolean)</em> When the boolean expression is <code>false</code> the assertion is triggered and the <code>message</code> is printed to the user. Terramate Variables (<code>let</code>, <code>global</code>, and <code>terramate</code> namespaces) and all Terramate Functions are supported.</li><li><code>message</code> <em>(required string)</em> A descriptive message to present to the user to inform about the causes that made an assertion fail. Terramate Variables (<code>let</code>, <code>global</code>, and <code>terramate</code> namespaces) and all Terramate Functions are supported.</li><li><code>warning</code> (optional boolean) When set to <code>true</code> the code generation will not fail, but a warning is issued to the user. Default is <code>false</code>. Terramate Variables (<code>let</code>, <code>global</code>, and <code>terramate</code> namespaces) and all Terramate Functions are supported.</li></ul></li></ul><h2 id="generating-different-file-types" tabindex="-1">Generating different file types <a class="header-anchor" href="#generating-different-file-types" aria-label="Permalink to &quot;Generating different file types&quot;">​</a></h2><h3 id="generating-a-json-file" tabindex="-1">Generating a JSON file <a class="header-anchor" href="#generating-a-json-file" aria-label="Permalink to &quot;Generating a JSON file&quot;">​</a></h3><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generate_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &quot;hello_world.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tm_jsonencode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="generating-a-yaml-file" tabindex="-1">Generating a YAML file <a class="header-anchor" href="#generating-a-yaml-file" aria-label="Permalink to &quot;Generating a YAML file&quot;">​</a></h3><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generate_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &quot;hello_world.yml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> tm_yamlencode</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;hello&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;world&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="generating-arbitrary-text" tabindex="-1">Generating arbitrary text <a class="header-anchor" href="#generating-arbitrary-text" aria-label="Permalink to &quot;Generating arbitrary text&quot;">​</a></h3><p>It is possible to use <a href="https://www.terraform.io/language/expressions/strings#strings-and-templates" target="_blank" rel="noreferrer">strings and templates</a> as known from Terraform.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">generate_file</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &quot;hello_world.json&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;-EOT</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    whatever text format you want, here is a global reference:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    a = </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">reference</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    and a metadata reference:</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    b = </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">terramate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">path</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  EOT</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div>`,16),l=[n];function o(r,h,p,d,c,k){return a(),s("div",null,l)}const u=e(t,[["render",o]]);export{E as __pageData,u as default};
