import{_ as a,c as e,o as s,a4 as i}from"./chunks/framework.Bl20_RFa.js";const b=JSON.parse('{"title":"Global Variables","description":"Learn how you can use Global Variables in Terramate to define data that can be used across multiple stacks.","frontmatter":{"title":"Global Variables","description":"Learn how you can use Global Variables in Terramate to define data that can be used across multiple stacks."},"headers":[],"relativePath":"cli/code-generation/variables/globals.md","filePath":"cli/code-generation/variables/globals.md"}'),l={name:"cli/code-generation/variables/globals.md"},t=i(`<h1 id="global-variables" tabindex="-1">Global Variables <a class="header-anchor" href="#global-variables" aria-label="Permalink to &quot;Global Variables&quot;">​</a></h1><p>Globals allow you to define data that can be reused across multiple stacks, using hierarchical merge semantics. This ensures consistent and easy data sharing within your Terramate project. Globals are often used in <a href="./../">code generation</a> to e.g. configure the Terraform version used in stacks programmatically.</p><h2 id="define-globals" tabindex="-1">Define Globals <a class="header-anchor" href="#define-globals" aria-label="Permalink to &quot;Define Globals&quot;">​</a></h2><p>Terramate Globals can be defined on any level of the hierarchy using a <code>globals</code> block definition:</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">globals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">variable</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">name</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expression</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Terramate globals are available in the <code>global</code> namespace via <code>global.&lt;variable-name&gt;</code> and can be part of any expression.</p><p>Terramate Variables (<code>let</code>, <code>global</code>, and <code>terramate</code> namespaces) and all <a href="./../functions/">Terramate Functions</a> are supported on the right side of the definition of a global variable.</p><p>Globals can be defined across multiple Terramate files, with the set of files in a specific directory referred to as a <strong>configuration</strong>. Following this terminology:</p><ul><li>A project has multiple configurations, one for each of its directories.</li><li>The most specific configuration is the stack directory.</li><li>The most general configuration is the project root directory.</li><li>Globals can&#39;t be redefined in the same configuration.</li><li>Globals can be redefined in different configurations.</li><li>Globals can reference globals from other configurations.</li><li>Globals are evaluated only in stack context and do not need to be fully defined on higher levels, i.e., they can reference another global that is not yet defined but will be defined on lower levels. For details please see <a href="#lazy-evaluation">Lazy evaluation</a>.</li></ul><p>When globals are redefined across different configurations, a simple merge strategy is adopted:</p><ul><li>Globals with different names are merged.</li><li>For globals with identical names, the more specific configuration replaces the general one.</li></ul><h2 id="unset-a-global" tabindex="-1">Unset a Global <a class="header-anchor" href="#unset-a-global" aria-label="Permalink to &quot;Unset a Global&quot;">​</a></h2><p>A global variable can be removed from the definition by assigning it the special value <code>unset</code>.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">globals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  no_longer_available</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> unset</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Upon unsetting, any access to the global will fail, as if the global was never defined.</p><p>This behavior affects the global throughout the entire hierarchy, leaving it undefined for all child configurations.</p><p>It&#39;s essential to note that <code>unset</code> can only be used in direct assignments to a global. It is not allowed in any other context.</p><h2 id="labeled-globals" tabindex="-1">Labeled Globals <a class="header-anchor" href="#labeled-globals" aria-label="Permalink to &quot;Labeled Globals&quot;">​</a></h2><p>As Terramate Globals are inherited through the hierarchy setting values in complex structures like maps is desired for some use cases. To set a specific value of a key within a <code>map</code> without redefining all keys in the map, the <code>globals</code> block supports labels to define what keys to set or replace.</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">globals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &lt;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">variable</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt; [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] ... {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  &lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> = </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expression</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>Example:</p><div class="language-hcl vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">hcl</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">globals</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &quot;mymap&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> &quot;nested&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  key</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;value&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      # set global.mymap.nested.key = &quot;value&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># equal initial definition without labels:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">globals</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  mymap</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set global.mymap = { nested = { key = &quot;value&quot; } }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    nested </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># set global.mymap.nested = { key = &quot;value&quot; }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      key </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;value&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # set global.mymap.nested.key = &quot;value&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>The following evaluation rules are applied and available:</p><ul><li>Any number of labels can be added to a <code>globals</code> block to set a nested value within a simple map or any level in maps of maps definitions.</li><li>Labeled globals are evaluated in order of precision: First all unlabeled globals are set, then globals with one label, followed by globals with two labels, etc.</li><li>When assigning labels not yet defined in a map or nested map, the map will be initialized and no previous definition is needed to define an empty map.</li><li>When trying to set a key within a previously defined conflicting type like string or list, an error is raised.</li></ul><p>Labeled Globals can be used to populate maps through the hierarchy and use inheritance to define keys only ones on higher levels inheriting them to multiple stacks.</p><p>Using <code>globals &quot;tags&quot; { env = &quot;production&quot; }</code> can help implement a natural tagging strategy for cloud resources without maintaining or redefining complex tags in multiple locations.</p><h2 id="lazy-evaluation" tabindex="-1">Lazy evaluation <a class="header-anchor" href="#lazy-evaluation" aria-label="Permalink to &quot;Lazy evaluation&quot;">​</a></h2><p>Given that globals can reference other globals and metadata, it is important to be clear about how and when evaluation happens.</p><p>Globals are lazily evaluated, which means globals block can reference variables that will exist at a later point in time. For example, a non-stack directory can have globals referencing stack metadata.</p><p>Below is a high-level overview of how globals evaluation is implemented for a given stack:</p><ul><li>The globals blocks are loaded from all Terramate files in the stack directory.</li><li>The multiple globals blocks are merged into a single globals definition.</li><li>Recursively, the parent directories have their globals blocks loaded and merged into the same single globals definition but giving preference for the Global defined lower in the filesystem tree.</li><li>Then resulting single <code>globals {}</code> block has its attributes evaluated. <ul><li>The <code>terramate.*</code> namespace is set with the stack <a href="./metadata">metadata</a> values.</li><li>Globals that depend on other globals are postponed until all dependencies are evaluated.</li></ul></li></ul><p>This means that globals can reference globals in other configurations independent of how specific or general the configuration is since it is all merged into a single set of globals before evaluation.</p><h2 id="debugging-globals" tabindex="-1">Debugging Globals <a class="header-anchor" href="#debugging-globals" aria-label="Permalink to &quot;Debugging Globals&quot;">​</a></h2><p>To see all globals available in each stack, the <code>terramate debug globals</code> command can be used. For details, please see the <a href="./../../cmdline/debug/show/debug-show-globals">debug globals</a> command.</p>`,34),n=[t];function o(h,r,p,d,c,g){return s(),e("div",null,n)}const u=a(l,[["render",o]]);export{b as __pageData,u as default};
